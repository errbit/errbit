<%# locals: (apps:) %>

<table class="apps">
  <thead>
    <tr>
      <th><%= t(".name") %></th>
      <% if any_github_repos? || any_bitbucket_repos? %>
        <th><%= t(".repository") %></th>
      <% end %>
      <% if any_notification_services? %>
        <th><%= t(".notify") %></th>
      <% end %>
      <% if any_issue_trackers? %>
        <th><%= t(".tracker") %></th>
      <% end %>
      <th><%= t(".errors") %></th>
    </tr>
  </thead>

  <tbody>
    <% apps.each do |app| %>
      <tr>
        <td class="name"><%= link_to(app.name, app_path(app)) %></td>

        <% if any_github_repos? || any_bitbucket_repos? %>
          <td class="github_repo">
            <% if app.github_repo? %>
              <%= link_to(app.github_repo, app.github_url, target: "_blank", rel: "noopener noreferrer") %>
            <% end %>
            <% if app.bitbucket_repo? %>
              <%= link_to(app.bitbucket_repo, app.bitbucket_url, target: "_blank", rel: "noopener noreferrer") %>
            <% end %>
          </td>
        <% end %>

        <% if any_notification_services? %>
          <td class="notification_service">
            <% if app.notification_service_configured? %>
              <% if app.notification_service.url %>
                <%= link_to app.notification_service.url, target: "_blank", rel: "noopener noreferrer" do %>
                  <i class="<%= fa_icon_class(app.notification_service.label) %>"></i>
                <% end %>
              <% else %>
                <i class="<%= fa_icon_class(app.notification_service.label) %>"></i>
              <% end %>
            <% end %>
          </td>
        <% end %>

        <% if any_issue_trackers? %>
          <td class="issue_tracker">
            <% if app.issue_tracker_configured? %>
              <% if app.issue_tracker.url %>
                <%= link_to app.issue_tracker.url do %>
                  <i class="<%= fa_icon_class(app.issue_tracker.type_tracker) %>"></i>
                <% end %>
              <% else %>
                <i class="<%= fa_icon_class(app.issue_tracker.type_tracker) %>"></i>
              <% end %>
            <% end %>
          </td>
        <% end %>

        <td class="count">
          <% if app.problem_count > 0 %>
            <% unresolved = app.unresolved_count %>

            <%= link_to(unresolved, app_path(app), class: (unresolved == 0 ? "resolved" : "")) %>
          <% end %>
        </td>
      </tr>
    <% end %>

    <% if apps.none? %>
      <tr>
        <td colspan="3">
          <em>
            <%= t(".no_apps") %>
            <%= link_to(t(".click_to_create"), new_app_path) %>
          </em>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
